
<h1 align="center">Data Catalog ‚Äî 100cep Gateway</h1>

<p align="center">
  <img src="https://img.shields.io/badge/Camada-Gold-FFD700?style=flat-square" alt="Gold Layer">
  <img src="https://img.shields.io/badge/Tabelas-6-blue?style=flat-square" alt="6 Tables">
  <img src="https://img.shields.io/badge/Modelo-Dimensional-green?style=flat-square" alt="Dimensional Model">
</p>

---

## üìö About This Catalog

This document contains the **complete documentation** of the data model for the **Gold** layer of the 100cep Gateway MVP. The model was structured following **dimensional Data Warehouse** principles, optimized for business analytics.

---

### Relationship Table

| Source Table | FK Column | Target Table | PK Column | Cardinalidade |
|--------------|-----------|----------------|-----------|---------------|
| **fato_transacoes** | cliente_id | dim_clientes | cliente_id | N:1 |
| **fato_transacoes** | vendedor_id | dim_vendedores | vendedor_id | N:1 |
| **fato_transacoes** | data_pedido | dim_data | data_calendario | N:1 |
| **fato_transacoes** | pedido_id | dim_chargebacks | pedido_id | N:0,1 |
| **dim_clientes** | cep_prefixo | dim_geolocalizacao | cep_prefixo | N:1 |
| **dim_vendedores** | cep_prefixo | dim_geolocalizacao | cep_prefixo | N:1 |

**Note**: Not all orders have chargebacks.

---

<h2 align="center">dim_chargebacks</h2>

**Type**: Event Dimension  
**Granularity**: 1 record = 1 chargeback request  
**Records**: ~1,000 chargebacks

<p align="center"> <img src="./images/databricks/dim_chargebacks.jpg" alt="dim_chargebacks" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| pedido_id | string | Unique identifier for each chargeback request, consisting of 13 alphanumeric characters in lowercase. |
| motivo_chargeback | string | Reason for the chargeback request, which may include fraud, non-receipt of products, defective product, among other causes. |
| status_chargeback | string | Current status of the chargeback request, indicating its progress stage. |
| resposta_emitente | string | Response provided by the card issuer regarding the chargeback request. |
| resposta_adquirente | string | Response provided by the acquirer regarding the chargeback request. |

**Value Domains**:
- `motivo_chargeback`: Fraud, Product not received, Product defective, Service issue, Unauthorized transaction, etc.
- `status_chargeback`: pending, approved, denied, investigating, closed
- `resposta_emitente`: Approved, Denied, Under Review, Pending Documentation
- `resposta_adquirente`: Accepted, Rejected, Requesting Evidence, Processing

**Business Rules**:
- ‚úÖ Not all orders have chargebacks (1:0..1 relationship)
- ‚úÖ Chargebacks are generated by an additional dataset (AI-generated)
- ‚úÖ Used for risk analysis and fraud detection

**Use**:
- Chargeback rate analysis
- Identification of fraud patterns
- Risk assessment by payment method/region
- Monitoring of financial losses

---

<h2 align="center">dim_data</h2>

<p align="center"> <img src="./images/databricks/dim_data.jpg" alt="dim_data" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| data_calendario | date | Date when the order was placed. Format: YYYY-MM-DD. |
| dia | int | Day number corresponding to the date in integer format. |
| mes | int | Month number corresponding to the date. |
| ano | int | Year number corresponding to the date. |
| nome_dia_semana | string | Weekday name corresponding to the date. |
| nome_mes | string | Month name corresponding to the date. |
**Use**:
- Identification of sellers in transactions
- Performance analysis by seller
- Geographic analysis of sellers

---

<h2 align="center">dim_geolocalizacao</h2>

**Type**: Geographic Dimension  
**Granularity**: 1 record = 1 ZIP code prefix (5 digits)  
**Records**: ~19,000 ZIP code prefixes

<p align="center"> <img src="./images/databricks/dim_geolocalizacao.jpg" alt="dim_geolocalizacao" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| cep_prefixo | string | The first 5 digits of the ZIP code. |
| cidade | string | City name associated with the ZIP code. |
| estado | string | Brazilian state abbreviation (two uppercase letters) associated with the ZIP code. |
| latitude | string | Geographic coordinate specifying the north-south position. |
| longitude | string | Geographic coordinate specifying the east-west position. |
**Use**:
- Identification of customers in transactions
- Geographic analysis (via `cep_prefixo`)
- Customer segmentation by region

---

<h2 align="center">dim_vendedores</h2>

**Type**: Dimension Table  
**Granularity**: 1 record = 1 seller  
**Records**: ~3,000 sellers

<p align="center"> <img src="./images/databricks/dim_vendedores.jpg" alt="dim_vendedores" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| vendedor_id | string | Unique identifier for each seller, consisting of 13 alphanumeric characters in lowercase. |
| cep_prefixo | string | The first 5 digits of the seller's postal code. |

<h2 align="center">fato_transacoes</h2>

**Type**: Fact Table  
**Granularity**: 1 record = 1 payment transaction per order  
**Records**: ~99,000 transactions

<p align="center"> <img src="./images/databricks/fato_transacoes.jpg" alt="ato_transacoes" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| pedido_id | string | Unique identifier for each transaction, consisting of 13 alphanumeric characters in lowercase. |
| cliente_id | string | Unique identifier for each client, consisting of 13 alphanumeric characters in lowercase. |
| vendedor_id | string | Unique identifier for each seller, consisting of 13 alphanumeric characters in lowercase. |
| data_pedido | date | Date when the order was placed. Format: YYYY-MM-DD. |
| horario_pedido | date | Time when the order was placed in the format HH:MM:SS. |
| tipo_pagamento | string | Payment method used for the transaction. |
| valor_transacao | decimal(12,2) | Transaction value in a decimal format with up to 12 digits and 2 decimal places, only positive values. |
| preco_total | decimal(16,2) | Total order price, including product price and shipping cost. |
| frete_total | decimal(15,2) | Total shipping cost in a decimal format with up to 15 digits and 2 decimal places, only positive values. |
| status_pedido | string | Current delivery status of the order. |

**Value Domains**:
- `tipo_pagamento`: credit_card, boleto, voucher, debit_card
- `status_pedido`: delivered, shipped, canceled, processing, unavailable, invoiced

**Business Rules**:
- ‚úÖ Only orders with status "delivered" are included
- ‚úÖ `preco_total` = sum of all items in the order
- ‚úÖ `frete_total` = sum of all shipping values of the items
- ‚úÖ `valor_transacao` can be different from `preco_total` (multiple payments)

---

<h2 align="center">dim_data</h2>

**Type**: Time Dimension  
**Granularity**: 1 record = 1 day  
**Records**: ~365 days (2016-2018)

<p align="center"> <img src="./images/databricks/dim_data.jpg" alt="dim_data" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| data_calendario | date | Date when the order was placed. Format: YYYY-MM-DD. |
| dia | int | Day number corresponding to the date in integer format. |
| mes | int | Month number corresponding to the date. |
| ano | int | Year number corresponding to the date. |
| nome_dia_semana | string | Weekday name corresponding to the date. |
| nome_mes | string | Month name corresponding to the date. |

**Value Domains**:
- `dia`: 1-31
- `mes`: 1-12
- `ano`: 2016-2018
- `nome_dia_semana`: Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday
- `nome_mes`: January, February, March, ..., December

---

<h2 align="center">dim_clientes</h2>

**Type**: Dimension Table  
**Granularity**: 1 record = 1 customer  
**Records**: ~99,000 customers

<p align="center"> <img src="./images/databricks/dim_clientes.jpg" alt="dim_clientes" width="100%"></p>

| Column | Type | Description |
| ------ | ---- | ----------- |
| cliente_id | string | Unique identifier for each client, consisting of 13 alphanumeric characters in lowercase. |
| cep_prefixo | string | The first 5 digits of the customer postal code. |

---

<h2 align="center">dim_vendedores</h2>

**Type**: Dimension Table  
**Granularity**: 1 record = 1 seller  
**Records**: ~3,000 sellers

<p align="center"> <img src="./images/databricks/dim_vendedores.jpg" alt="dim_vendedores" width="100%"></p>

Column | Type | Description
| ------ | ---- | ----------- |
| vendedor_id | string | Unique identifier for each seller, consisting of 13 alphanumeric characters in lowercase. |
| cep_prefixo | string | The first 5 digits of the seller's postal code. |

---

<h2 align="center">dim_geolocalizacao</h2>

**Type**: Geographic Dimension  
**Granularity**: 1 record = 1 ZIP code prefix (5 digits)  
**Records**: ~19,000 ZIP code prefixes

<p align="center"> <img src="./images/databricks/dim_geolocalizacao.jpg" alt="dim_geolocalizacao" width="100%"></p>

Column | Type | Description
| ------ | ---- | ----------- |
| cep_prefixo | string | The first 5 digits of the ZIP code. |
| cidade | string | City name associated with the ZIP code. |
| estado | string | Brazilian state abbreviation (two uppercase letters) associated with the ZIP code. |
| latitude | string | Geographic coordinate specifying the north-south position. |
| longitude | string | Geographic coordinate specifying the east-west position. |

**Value Domains**:
- `estado`: Abbreviations of the 27 Brazilian states (AC, AL, AM, AP, BA, CE, DF, ES, GO, MA, MG, MS, MT, PA, PB, PE, PI, PR, RJ, RN, RO, RR, RS, SC, SE, SP, TO)
- `latitude`: -33.75 to 5.27 (Brazil boundaries)
- `longitude`: -73.99 to -34.79 (Brazil boundaries)

---

## üîó Data Lineage

### Transformation Flow

```
üìÇ Kaggle CSV Files
    ‚Üì
üíæ Unity Catalog Volumes
    ‚Üì
üü´ Bronze Layer (Raw)
    ‚îú‚îÄ bronze_customers
    ‚îú‚îÄ bronze_orders
    ‚îú‚îÄ bronze_order_payments
    ‚îú‚îÄ bronze_order_items
    ‚îú‚îÄ bronze_sellers
    ‚îú‚îÄ bronze_geolocation
    ‚îî‚îÄ bronze_chargebacks
    ‚Üì
üßπ Silver Layer (Cleaned)
    ‚îú‚îÄ silver_customers      [limpeza + valida√ß√£o]
    ‚îú‚îÄ silver_orders        [convers√£o temporal]
    ‚îú‚îÄ silver_order_payments [agrega√ß√£o]
    ‚îú‚îÄ silver_order_items    [agrega√ß√£o]
    ‚îú‚îÄ silver_sellers       [padroniza√ß√£o]
    ‚îú‚îÄ silver_geolocation   [deduplica√ß√£o]
    ‚îî‚îÄ silver_chargebacks   [enriquecimento]
    ‚Üì
üèÜ Gold Layer (Analytics) ‚Üê YOU ARE HERE!
    ‚îú‚îÄ fato_transacoes
    ‚îú‚îÄ dim_data
    ‚îú‚îÄ dim_clientes
    ‚îú‚îÄ dim_vendedores
    ‚îú‚îÄ dim_geolocalizacao
    ‚îî‚îÄ dim_chargebacks
```

### Column Mapping (Main)

| Origin (Kaggle) | Bronze | Silver | Gold | Transformation |
|----------------|--------|--------|------|----------------|
| order_id | order_id | pedido_id | pedido_id | Translation |
| customer_id | customer_id | cliente_id | cliente_id | Translation |
| order_purchase_timestamp | order_purchase_timestamp | data_compra (TIMESTAMP) | data_pedido (DATE) | Conversion + Split |
| payment_value | payment_value (STRING) | valor_pagamento (DECIMAL) | valor_transacao (DECIMAL) | Type cast + Aggregation |
| zip_code_prefix | zip_code_prefix | cep_prefixo | cep_prefixo | Translation |

**Complete transformation documentation**: [/docs/etl.md](./etl.md)

---

## ‚úÖ Quality Validations

- [x] Unique primary keys (no duplicates)
- [x] Valid foreign keys (referential integrity)
- [x] Correct and consistent data types
- [x] Values within expected domains
- [x] Nulls only in optional fields
- [x] Geographic coordinates within Brazil's boundaries
- [x] Dates within the expected range (2016-2018)
- [x] Positive numeric values (except lat/long)

---
